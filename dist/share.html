<!doctype html><html><head><meta charset=UTF-8><title>Node命令行(CLI)工具开发 - By jackieli</title><link rel=stylesheet href=//cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=//cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link href=./css/chunk-vendors.752b92c9.css rel=stylesheet></head><body><div><article id=webslides><section slide class="slide bg-apple aligncenter" image="http://static.lilidong.cn/bg.jpg .dark"><header class=alignright><div class=wrap><p> </p></div></header><span class="background dark" style="background-image:url('http://static.lilidong.cn/bg.jpg')"></span><div class=wrap wrap=true><div class="aligncenter text-subtitle animated fadeIn"><h1>Node命令行(CLI)工具开发</h1></div></div><footer><div class=wrap><p class=alignleft> </p><p><a href=https://github.com/jackieli123723 class=alignright target=_blank><i class="fa fa-github"></i> jackieli</a></p></div></footer></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-100">Node命令行(CLI)工具开发</h4><ul><li class="text-subtitle animated fadeInDown delay-300">CLI是什么？</li><li class="text-subtitle animated fadeInDown delay-400">CLI工具的应用</li><li class="text-subtitle animated fadeInDown delay-500">CLI开发的模块介绍</li><li class="text-subtitle animated fadeInDown delay-600">CLI数据交互和爬虫数据抓取</li><li class="text-subtitle animated fadeInDown delay-700">Node 写 CLI 基本步骤</li><li class="text-subtitle animated fadeInDown delay-800">总结和Q&amp;A</li></ul></div></section><section slide class="slide bg-apple fullscreen"><div class=wrap wrap=true><div class="bg-apple animated fadeInLeft delay-300 card-50"><figure><img src=http://static.lilidong.cn/bgcli.png alt=""></figure><div class=flex-content><h2>CLI是什么？</h2><p><br>命令行界面（英语：Command-Line Interface，缩写：CLI）是在图形用户界面得到普及之前使用最为广泛的用户界面，它通常不支持鼠标，用户通过键盘输入指令，计算机接收到指令后，予以执行。也有人称之为字符用户界面（character user interface, CUI）。</p><p>通常认为，命令行界面（CLI）没有图形用户界面（GUI）那么方便用户操作。因为，命令行界面的软件通常需要用户记忆操作的命令，但是，由于其本身的特点，命令行界面要较图形用户界面节约计算机系统的资源。在熟记命令的前提下，使用命令行界面往往要较使用图形用户界面的操作速度要快。所以，在现在的图形用户界面的操作系统中，通常都保留着可选的命令行界面。</p></div></div></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">CLI工具的应用    </h4><ul><li class="text-lowercase text-subtitle animated fadeInUp delay-300">系统命令：cd、mkdir、ifconfig</li><li class="text-lowercase text-subtitle animated fadeInUp delay-400">脚手架工具：create-react-app、@vue/cli、@angular/cli<img src=https://img.shields.io/npm/v/%40angular/cli.svg></li><li class="text-lowercase text-subtitle animated fadeInUp delay-500">预处理器：less、sass、babel</li><li class="text-lowercase text-subtitle animated fadeInUp delay-600">测试工具：mocha、karma<img src="https://img.shields.io/npm/v/karma.svg?style=flat-square">、jest</li><li class="text-lowercase text-subtitle animated fadeInUp delay-700">构建工具：webpack<img src=https://img.shields.io/npm/v/webpack.svg>、gulp、rollup、ts-node</li><li class="text-lowercase text-subtitle animated fadeInUp delay-800">可以全局安装的npm包几乎都是CLI</li></ul></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="animated tada">CLI开发的常用模块介绍</h4><ul><li class="text-lowercase text-subtitle animated fadeInUp delay-300"><strong>commander</strong> 注册、解析命令行参数 <img src="http://img.shields.io/npm/v/commander.svg?style=flat"></li><li class="text-lowercase text-subtitle animated fadeInUp delay-400"><strong>colors</strong> 输出流颜色 <img src=https://img.shields.io/npm/v/colors.svg></li><li class="text-lowercase text-subtitle animated fadeInUp delay-500"><strong>yargs</strong> 解析传递参数 <img src=https://img.shields.io/npm/v/yargs.svg></li><li class="text-lowercase text-subtitle animated fadeInUp delay-600"><strong>cheerio</strong> 抓取接口数据或者网页的源代码 <a href=https://www.npmjs.com/package/cheerio target=_blank><i class="fa fa-github-alt"></i></a></li><li class="text-lowercase text-subtitle animated fadeInUp delay-700"><strong>axios</strong> 抓取接口数据或者网页的源代码 <img src="https://img.shields.io/npm/v/axios.svg?style=flat-square"></li><li class="text-lowercase text-subtitle animated fadeInUp delay-800"><strong>request</strong> 可以用代理抓取接口 <a href=https://www.npmjs.com/package/request target=_blank><i class="fa fa-github-alt"></i></a></li></ul></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">CLI数据交互和爬虫数据抓取</h4><p><code>cli</code> 工具的数据来源<a href=http://www.weather.com.cn/weather1dn/101010100.shtml class="text-lowercase text-subtitle animated fadeInUp delay-300" target=_blank>新版中国天气网</a></p><ul><li class="text-lowercase text-subtitle animated fadeInUp delay-400">抓包分析</li><li class="text-lowercase text-subtitle animated fadeInUp delay-500">异步js加载的执行分析</li><li class="text-lowercase text-subtitle animated fadeInUp delay-600">反爬虫数据策略的处理</li><li class="text-lowercase text-subtitle animated fadeInUp delay-700">数据来源处理DA聚合</li></ul></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">抓包分析</h4><p class="animated fadeInUp"><img src=./img/t0.5d1501d5.png class=aligncenter></p></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">抓包分析</h4><p class="animated fadeInUp">这是正常渲染后的数据,对比<code>上图</code>可以看出来这里的数据是异步注入的,单通过抓取dom结构没有数据？ <img src=./img/t1.4f99406c.png class=aligncenter></p></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">异步js加载的执行分析</h4><p>怎么才能拿到数据？ （断点分析 或无头浏览器Puppeteer）</p><p class="animated fadeInUp"><img src=./img/break.cba37468.png class=aligncenter></p></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">反爬虫数据策略的处理</h4><p>数据抓取接口和url的限制拿不到数据</p><img src=./img/f1.1fbac808.png class=aligncenter></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">反爬虫数据策略的处理</h4><p><br>还可能出现这样的页面？是不是<img src=./img/201210101411224961.88186aac.gif>的感觉</p><img src=./img/f2.07f62903.png class=aligncenter></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">突破数据爬取限制</h4><p>模拟浏览器行为 <code>referer</code> <code>User-Agent</code></p><img src=./img/postman40d.688e0a61.png class=aligncenter></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">突破数据爬取限制</h4><p>代码模拟实现</p><img src=./img/air.015071e4.png class="size-50 aligncenter"></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">数据来源处理DA聚合</h4>使用Koa2来提供api服务截取,数据来源处理DA聚合 <img src=./img/1dsda.4036b426.png class="size-40 aligncenter"></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">数据来源处理DA聚合</h4><img src=./img/s1.33459f56.png class="size-40 aligncenter"></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="text-subtitle animated fadeInDown delay-300">进入正题</h4><p class=bounce>说了半天好像也没有说到如何开发一个CLI</p></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>Node 写 CLI 基本步骤</h4><br>命名 CLI 配置 <code>package.json</code>（添加 bin 字段）<br><br><img src=./img/package.af0f9874.png></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>Node 写 CLI 基本步骤</h4><p>条件参数传递<br></p><p>weather -c 成都 -t -d 1<br>weather -c 成都 -j -d 7 --hourly --date 12-06</p><p class=aligncenter><img src=./img/arg.5156933e.png></p></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>Node 写 CLI 基本步骤</h4><br>入口文件顶部添加 <code>#!/usr/bin/env node</code> （告诉系统，这个脚本使用 Node.js 来执行）<br><br><img src=./img/env.80d1ea7d.png class="aligncenter size-40"></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>Node 写 CLI 基本步骤</h4><br>执行 <code>npm link</code>, 在全局的 node_modules 下生成一个软链接<br><br>测试 CLI 工具（可以全局使用 CLI）<br><br><img src=./img/link.722c2ec7.png></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>全局测试命令</h4><img src=./img/test.d646dee7.png class="aligncenter size-40"></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>全局测试命令</h4><img src=./img/windemo.79f6a77e.png class=aligncenter></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>爬取成都未来15天数据</h4><img src=./img/15d.3f5c6d86.png class=aligncenter></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>wci-cli-tool 源码</h4></div></section><section slide class="slide bg-white"><div class=wrap wrap=true><iframe frameborder=0 width=100% height=100% style=width:100%;height:100%;position:fixed;top:0;left:0;right:0;bottom:0; src="https://source.runkitcdn.com/npm/wci-cli-tool/lib/weather.js?t=1575533053272&engine=10.x.x"></iframe></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4>数据来源处理DA聚合 源码（Koa2）</h4></div></section><section slide class="slide bg-white"><div class=wrap wrap=true><iframe frameborder=0 width=100% height=100% style=width:100%;height:100%;position:fixed;top:0;left:0;right:0;bottom:0; src="https://source.runkitcdn.com/npm/wci-cli-tool/server.js?t=1575533053272&engine=10.x.x"></iframe></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="animated tada">总结</h4><p>本次分享通过一个<code>基于爬虫的天气预报 CLI 工具</code>的开发、发布流程，并总结了一些开发注意事项和常用的库。旨在帮助 <code>JavaScript</code> 开发人员入门 <code>CLI 工具</code>开发。希望大家都能在掌握 <code>CLI 工具</code>开发流程后，发挥想象力，开发出一些实用、好玩的轮子，让我们的工作开发效率变得高效</p></div></section><section slide class="slide bg-apple aligncenter"><div class=wrap wrap=true><h4 class="animated tada">Q&amp;A</h4><p>安装使用</p><code>npm i wci-cli-tool</code> <img src="https://img.shields.io/npm/v/wci-cli-tool.svg?style=flat"><img src=https://img.shields.io/npm/dm/wci-cli-tool.svg><br><br><br><p><a href=https://www.npmjs.com/package/wci-cli-tool class="button animated delay-1s fadeInUp" target=_blank><i class="fa fa-cloud-download"></i> Github</a></p></div></section></article></div><script src=//cdn.staticfile.org/echarts/4.1.0-release/echarts.min.js></script><script src=background.js></script><script>window.pluginsOptions = {}



document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const ws = new WebSlides({
        loop: false
    })
    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./js/chunk-vendors.b84dd93c.js></script><script src=./js/share.fe0f13de.js></script></body></html>